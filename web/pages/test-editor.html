<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>R#BD ‚Äî √âditeur de test</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/templates.css" />
    <link rel="stylesheet" href="../css/editor.css" />
    <script src="../js/header-loader.js"></script>
</head>

<body>
    <!-- Header charg√© dynamiquement -->

    <main class="guide-main">
        <section class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <h2 id="editor-title" style="margin: 0;">√âditeur de test</h2>
                        <select id="test-type" class="form-input" style="width: 90px; padding: 6px 10px;">
                            <option value="ru">RU</option>
                            <option value="cvs">CVS</option>
                            <option value="mvs">MVS</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" onclick="window.history.back()">
                        ‚Üê Retour
                    </button>
                    <button class="btn btn-primary" onclick="saveTest()">
                        üíæ Sauvegarder
                    </button>
                </div>
            </div>
        </section>

        <!-- Section Identification -->
        <section class="card">
            <div class="card-header">
                <h3 style="margin: 0;">Identification du test</h3>
            </div>
            <div class="divider"></div>

            <div class="form-grid">
                <div class="form-group">
                    <label>ID (auto)</label>
                    <input type="text" id="test-id" class="form-input" placeholder="Auto: RU-XXXXXX" readonly>
                    <div class="field-hint">G√©n√©r√© automatiquement (ID al√©atoire)</div>
                </div>

                <div class="form-group">
                    <label>Nom du test</label>
                    <input type="text" id="test-name" class="form-input" placeholder="Nom du test">
                </div>

                <div class="form-group">
                    <label>IED</label>
                    <select id="test-ied" class="form-input">
                        <option value="">S√©lectionner un IED</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Variant</label>
                    <select id="test-variant" class="form-input">
                        <option value="">‚Äî Aucun ‚Äî</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>LD</label>
                    <select id="test-ld" class="form-input">
                        <option value="">S√©lectionner un LD</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>LN</label>
                    <select id="test-ln" class="form-input">
                        <option value="">S√©lectionner un LN</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>LNinst</label>
                    <select id="test-lninst" class="form-input">
                        <option value="">S√©lectionner LNinst</option>
                    </select>
                </div>
            </div>

        </section>

        <!-- Section Description / Pr√©conditions / √âl√©ments li√©s (compact) -->
        <section class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">Description, pr√©conditions & √©l√©ments li√©s</h3>
            </div>
            <div class="divider"></div>

            <div class="compact-row">
                <!-- Description -->
                <div class="compact-col">
                    <label class="form-label">Description</label>
                    <textarea id="test-description" class="form-input description-input" rows="6"
                        placeholder="Description d√©taill√©e du test"></textarea>
                </div>

                <!-- Pr√©conditions -->
                <div class="compact-col">
                    <label class="form-label">Pr√©conditions</label>
                    <div class="compact-actions">
                        <button class="btn-icon-add" onclick="addPrecondition()">
                            ‚ûï Pr√©condition
                        </button>
                    </div>
                    <div id="preconditions-container" class="compact-list">
                        <p class="text-muted precondition-empty" id="no-preconditions">Aucune pr√©condition</p>
                    </div>
                </div>

                <!-- √âl√©ments li√©s -->
                <div class="compact-col">
                    <label class="form-label">√âl√©ments li√©s</label>
                    <div class="linked-tests-zone compact-links">
                        <div class="compact-links-row">
                            <div class="file-upload-zone compact-upload"
                                onclick="document.getElementById('file-input').click()">
                                <div class="compact-upload-content">
                                    <span class="compact-upload-icon">üìÅ</span>
                                    <span>Fichier</span>
                                </div>
                            </div>
                            <button class="btn-link-test" onclick="linkTestRU()">‚ûï RU</button>
                            <button class="btn-link-test" onclick="linkTestMVS()">‚ûï MVS</button>
                            <button class="btn-link-test" onclick="linkTestCVS()">‚ûï CVS</button>
                        </div>
                        <input type="file" id="file-input" multiple style="display: none;"
                            onchange="handleFileUpload(event)">
                        <div id="files-list" class="compact-list"></div>
                        <div id="tests-ru-list" class="compact-list"></div>
                        <div id="tests-mvs-list" class="compact-list"></div>
                        <div id="tests-cvs-list" class="compact-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section √âtapes du test -->
        <section class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">√âtapes du test</h3>
                <button class="btn-icon-add" onclick="addStep()">
                    ‚ûï √âtape
                </button>
            </div>
            <div class="divider"></div>

            <div id="steps-container">
                <!-- √âtapes ajout√©es dynamiquement -->
                <p class="text-muted" id="no-steps">Aucune √©tape. Cliquez sur "‚ûï √âtape" pour en ajouter.</p>
            </div>
        </section>

        <!-- Section Chronogramme -->
        <section class="card">
            <div class="card-header">
                <h3 style="margin: 0;">Chronogramme</h3>
                <p class="muted" style="margin: 4px 0 0 0;">G√©n√©r√© automatiquement √† partir des √©tapes</p>
            </div>
            <div class="divider"></div>

            <div id="chronogram-container"
                style="min-height: 200px; background: #f8f9fa; border-radius: 8px; padding: 20px; text-align: center; color: var(--muted);">
                <p style="margin: 0;">Le chronogramme sera g√©n√©r√© automatiquement d√®s que vous ajouterez des √©tapes</p>
            </div>
        </section>

        <!-- Section Informations -->
        <section class="card">
            <div class="card-header">
                <h3 style="margin: 0;">Informations compl√©mentaires</h3>
            </div>
            <div class="divider"></div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                <!-- CDE -->
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label class="form-label">üìä Informations CDE</label>
                        <button class="btn-icon-small" onclick="addCDE()">‚ûï</button>
                    </div>
                    <div id="cde-container">
                        <p class="text-muted-small">Aucun CDE ajout√©</p>
                    </div>
                </div>

                <!-- Alarmes -->
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label class="form-label">‚ö†Ô∏è Alarmes</label>
                        <button class="btn-icon-small" onclick="addAlarme()">‚ûï</button>
                    </div>
                    <div id="alarmes-container">
                        <p class="text-muted-small">Aucune alarme ajout√©e</p>
                    </div>
                </div>

                <!-- Informations TCD -->
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label class="form-label">‚ÑπÔ∏è Informations TCD</label>
                        <button class="btn-icon-small" onclick="addTCD()">‚ûï</button>
                    </div>
                    <div id="tcd-container">
                        <p class="text-muted-small">Aucune information TCD</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Boutons de sauvegarde -->
        <section class="card" style="display: flex; justify-content: space-between; align-items: center;">
            <button class="btn btn-secondary" onclick="window.history.back()">
                ‚Üê Annuler
            </button>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" onclick="previewTest()">
                    üëÅÔ∏è Pr√©visualiser
                </button>
                <button class="btn btn-primary" onclick="saveTest()">
                    üíæ Sauvegarder le test
                </button>
            </div>
        </section>
    </main>

    <script src="../js/test-editor.js"></script>
    <script>
        loadHeader({
            activePage: 'templates-essais',
            title: 'R#BD ‚Äî √âditeur de test'
        });

        // Initialiser l'√©diteur
        document.addEventListener('DOMContentLoaded', () => {
            initEditor();
        });
    </script>
</body>

</html>